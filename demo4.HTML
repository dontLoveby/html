<!-- 1.6 -->
<!DOCTYPE html>
<html>
<head>
    <title>文字生存小游戏</title>
    <style>
        #debug {
            text-align: start;
            border: 10px slategray;
        }
        #game-area {
            width: 600px;
            height: 450px;
            border: 1px solid black;
            margin: 0 auto;
            padding: 10px;
            font-family: Arial, sans-serif;
            font-size: 16px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }

        #player-info {
            text-align: center;
        }

        #options {
            display: flex;
            justify-content: center;
        }
    </style>
</head>

<body>
    <div id="game-area">
        <div id="debug">
            <p id="timer1">timer=0</p>
        </div>
        <div id="player-info">
            <p id="health">健康值: 100</p>
            <button id="inventory">物品: 无</button>
            <p id="physical">体力值：1000/1000</p>
            <p id="hunger-levels">饥饿值：100</p>
        </div>
        
        <div id="game-text">
            <p>欢迎来到文字生存小游戏！</p>
        </div>
        <div id="options">
            <button id="choice1" onclick="getButtonText(event)">探索</button>
            <button id="choice2" onclick="getButtonText(event)">休息</button>
            <button id="choice3" onclick="getButtonText(event)">进食</button>
        </div>
    </div>

    <script>
        // 定义游戏状态和开始场景
        let gameState = "explore";
        let playerInventory = {
            apple : 0,
            banana : 0,
            length : 2,
            textlist : ["apple", "banana"],
            getPrintText: function() {
                var printText = "";
                if (this.apple != 0) {
                    printText += "苹果*" + String(this.apple);
                }
                if (this.banana != 0) {
                    printText += "香蕉*" + String(this.banana);
                }
                console.log(printText);
                return printText;
            }
        };

        let playerHealth = 100;
        let upperlimitHealth = 100;
        let playerPhysical = 1000;//体力
        let upperlimitPhysical = 1000;
        let playerHunger = 100;//饥饿度
        let upperlimithunger = 100;

        let state = 1;
        let value;
        let buttonText = "";
        let infomame = {choice1 : "探索：", choice2 : "休息："};
        const duration = 2; // 倒计时时长，单位为秒
        const displayElement = document.getElementById("timer"); // 用于显示计时器的元素
        const timer = countdownTimer(duration, displayElement);
        //const button1 = document.getElementById("choice1");

        function getButtonText(event) {
            // 获取当前按下的按钮元素
            var button = event.target;
            // 获取当前按钮的文本
            buttonText = button.innerText;
            // 打印按钮文本
            console.log(buttonText);
        }

        // 计时器
        function countdownTimer(duration, displayElement) {
            let timer = duration;
            let intervalId;

            const startTimer = () => {
                clearInterval(intervalId); // 清除之前的定时器
                intervalId = setInterval(() => {
                    const minutes = Math.floor(timer / 60).toString().padStart(2, '0');
                    const seconds = (timer % 60).toString().padStart(2, '0');
                    //displayElement.textContent = minutes + ":" + seconds;
                    if (--timer <= 0) {
                        clearInterval(intervalId);
                        //displayElement.textContent = "Time's up!";
                    }
                }, 1000);
            };
            const stopTimer = () => {
                clearInterval(intervalId);
            };
            const getValue = () => {
                return timer;
            };
            const restartTimer = () => {
                timer = duration; // 重置计时器数值
                startTimer(); // 开始计时
            };

            return {
                start: startTimer,
                stop: stopTimer,
                restart: restartTimer,
                getValue: getValue
            };
        }

        // 函数：处理选择1
        const handleChoice1 = () => {
            //const min = 1;
            //生成0~5随机整数
            const max = 5;
            const randomInt = Math.floor(Math.random() * (max + 1));
            updateTimer();
            if (playerHunger >= -25 && playerPhysical >= 114) {
                // 处理场景中选择1的结果
                /*if (gameState === "start") {
                    document.getElementById("game-text").innerHTML = "你决定外出探索。</p>";
                    gameState = "explore";
                } else */
                if (randomInt === 0) {
                    document.getElementById("game-text").innerHTML = "你找到了一些蜂蜜，恢复了体力、饥饿度！</p>";
                    playerHunger += 15;
                    playerPhysical += 200;
                    //gameState = "start";
                } else if (randomInt === 1) {
                    document.getElementById("game-text").innerHTML = "你找到了一些苹果！</p>";
                    playerInventory.apple = 1;
                    //gameState = "start";
                } else {
                    document.getElementById("game-text").innerHTML = "你什么都没找到！</p>";
                    //gameState = "start";
                }
                if (gameState === "explore") {
                    playerPhysical -= 114;
                    playerHunger -= 3;
                    if (playerHealth > upperlimitHealth) {
                        playerHealth = upperlimitHealth;
                    }
                    if (playerHunger > upperlimithunger){
                        playerHunger = upperlimithunger;
                    }
                }
            } else {
                document.getElementById("game-text").innerHTML = "体力或饥饿度不足!</p>"
            }
            updatePlayerInfo();
        };
        
        // 函数：处理选择2
        const handleChoice2 = () => {
            // 处理场景中选择2的结果
            updateTimer();
            document.getElementById("game-text").innerHTML = "你休息得很好，恢复了健康！</p>";
            playerHealth += playerHunger / 15 - 4;
            playerHunger -= 10;
            playerPhysical = upperlimitPhysical + playerHunger - 95;
            if (playerHealth > upperlimitHealth) {
                playerHealth = upperlimitHealth;
            }
            
            updatePlayerInfo();
        };
        const handleChoice3 = () => {
            // 处理场景中选择3的结果
            if (playerInventory.apple >= 1){
                playerInventory.apple -= 1;
                playerHunger += 16;
                playerPhysical += 160;
                document.getElementById("game-text").innerHTML = " 进食了一颗苹果，饥饿度+16，体力+160.</p>"
            }
            updatePlayerInfo();
        }
        const handleChoiceInventory = () => {
            // 处理场景中选择3的结果
        }
        
        // 函数：更新玩家信息
        const updatePlayerInfo = () => {
            document.getElementById("health").textContent = "健康值: " + playerHealth;
            document.getElementById("inventory").textContent = "物品: " + playerInventory.getPrintText();
            document.getElementById("physical").textContent = "体力值：" + playerPhysical + "/" + upperlimitPhysical;
            document.getElementById("hunger-levels").textContent = "饥饿度：" + playerHunger;
        };

        // 更新游戏状态
        const updateGameInfo = () => {
            var a = 0;
            var b;
            //eventbuttonText = options.innerText;
            value = timer.getValue(); // 获取计时器数值
            document.getElementById("debug").innerHTML = "timer=" + value;
            if (value > 0 && state === 1) {
                document.getElementById("game-text").innerHTML = buttonText + ":" + document.getElementById("game-text").innerHTML;
                state = 0;
            } else if (value === 0){
                b = document.getElementById("game-text").innerHTML.substring(0, 4);
                if (b === buttonText + ":" || b === "<p>" + buttonText.substring(0, 1)) {
                    a = 3;
                    if (document.getElementById("game-text").innerHTML.substring(0, 3) === "<p>") {
                        a += 3;
                    } else {
                        a += 0;
                    }
                }
                document.getElementById("game-text").innerHTML = document.getElementById("game-text").innerHTML.substring(a);
                state = 1;
            }
            if (document.getElementById("game-text").innerHTML.substring(0, 3) != "<p>") {
                document.getElementById("game-text").innerHTML = "<p>" + document.getElementById("game-text").innerHTML;
            }
        }
        // 按钮点击事件处理函数?

        const updateTimer = () =>{
            state = 1;
            timer.restart(); //重新计时
        }
        timer.start()// 开始计时器
        const intervalId = setInterval(updateGameInfo, 100);
        // 添加事件监听器
        document.getElementById("choice1").addEventListener("click", handleChoice1);
        document.getElementById("choice2").addEventListener("click", handleChoice2);
        document.getElementById("choice3").addEventListener("click", handleChoice3);
    </script>
</body>
</html>
